
pool:
  vmImage: 'windows-latest'

name: $(Release)$(Rev:.r)

steps:
  - task: DownloadGitHubRelease@0
    inputs:
      connection: 'captncraig'
      userRepository: 'StackExchange/dnscontrol'
      defaultVersionType: "v$(Release)"
      itemPattern: 'dnscontrol.exe'
      downloadPath: '.'
  - script: |
      choco pack --version=$(Release) --outdir=$(Build.ArtifactStagingDirectory)
      choco apikey -k $(CHOCO_API) -source https://push.chocolatey.org/
    displayName: "Choco pack and push"
  
  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)'
      ArtifactName: 'nupkg'
      publishLocation: 'Container'